<!-- الناف بار -->
<app-navbar></app-navbar>

<!-- صفحة سلة التسوق -->
<main class="cart-page" dir="rtl">
  <!-- خلفية متحركة -->
  <div class="animated-background">
    <div class="gradient-layer"></div>
    <div class="pattern-layer"></div>
  </div>

  <!-- العنوان الرئيسي -->
  <section class="hero-section">
    <div class="container">
      <div class="hero-content">
        <div class="hero-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h1 class="page-title">سلة التسوق</h1>
        <p class="page-subtitle">مراجعة وإدارة منتجاتك المختارة</p>
        <div class="cart-stats">
          <span class="stats-item">
            <i class="fas fa-box"></i>
            {{ cartItems.length }} منتج
          </span>
          <span class="stats-item">
            <i class="fas fa-money-bill-wave"></i>
            {{ total | number:'1.2-2' }} ج.م
          </span>
        </div>
      </div>
    </div>
  </section>

  <!-- محتوى السلة -->
  <section class="cart-content">
    <div class="container">
      <!-- حالة السلة الفارغة -->
      <div *ngIf="cartItems.length === 0" class="empty-cart">
        <div class="empty-cart-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h2 class="empty-cart-title">سلة التسوق فارغة</h2>
        <p class="empty-cart-text">
          لم تقم بإضافة أي منتجات إلى السلة بعد. ابدأ التسوق الآن واكتشف منتجاتنا المميزة!
        </p>
        <a routerLink="/auth/home" class="btn-start-shopping">
          <i class="fas fa-shopping-bag"></i>
          ابدأ التسوق الآن
        </a>
      </div>

      <!-- محتوى السلة -->
      <div *ngIf="cartItems.length > 0" class="cart-layout">
        <!-- منتجات السلة -->
        <div class="cart-items-section">
          <div class="section-header">
            <h3 class="section-title">
              <i class="fas fa-list"></i>
              منتجاتك المختارة ({{ cartItems.length }})
            </h3>
            <button class="clear-cart-btn" (click)="clearCart()">
              <i class="fas fa-trash"></i>
              إفراغ السلة
            </button>
          </div>

          <!-- قائمة المنتجات -->
          <div class="cart-items-list">
            <div *ngFor="let item of cartItems; let i = index" class="cart-item">
              <div class="item-number">{{ i + 1 }}</div>
              
              <div class="item-image">
                <img [src]="item.imageUrl || 'assets/images/placeholder.jpg'" 
                     [alt]="item.name" 
                     class="product-img">
              </div>

              <div class="item-details">
                <h4 class="item-name">{{ item.name }}</h4>
                <p class="item-pharmacy">
                  <i class="fas fa-clinic-medical"></i>
                  {{ item.pharmacyName || 'RxClose' }}
                </p>
                <div class="item-price">
                  <span class="price">{{ item.price }} ج.م</span>
                </div>
              </div>

                             <div class="item-actions">
                 <!-- تحكم في الكمية -->
                 <div class="quantity-control">
                   <button type="button" 
                           class="qty-btn minus" 
                           (click)="decreaseQuantity(item)"
                           [disabled]="item.quantity <= 1"
                           title="تقليل الكمية">
                     <i class="fas fa-minus"></i>
                   </button>
                   <span class="quantity">{{ item.quantity }}</span>
                   <button type="button" 
                           class="qty-btn plus" 
                           (click)="increaseQuantity(item)"
                           title="زيادة الكمية">
                     <i class="fas fa-plus"></i>
                   </button>
                 </div>

                 <!-- إجمالي السعر -->
                 <div class="item-total">
                   <span class="total-label">الإجمالي:</span>
                   <span class="total-price">{{ getItemTotal(item) | number:'1.2-2' }} ج.م</span>
                 </div>

                 <!-- زر الحذف -->
                 <button type="button" 
                         class="remove-btn" 
                         (click)="removeItem(item)"
                         title="حذف المنتج">
                   <i class="fas fa-trash-alt"></i>
                 </button>
               </div>
            </div>
          </div>

          <!-- أزرار الإجراءات -->
          <div class="cart-actions">
            <a routerLink="/auth/search" class="btn-secondary">
              <i class="fas fa-arrow-right"></i>
              متابعة التسوق
            </a>
          </div>
        </div>

        <!-- ملخص الطلب -->
        <div class="order-summary">
          <div class="summary-header">
            <h3 class="summary-title">
              <i class="fas fa-receipt"></i>
              ملخص الطلب
            </h3>
          </div>

                     <div class="summary-content">
             <div class="summary-row">
               <span class="label">عدد المنتجات:</span>
               <span class="value">{{ cartItems.length }} منتج</span>
             </div>

             <div class="summary-row">
               <span class="label">عدد القطع:</span>
               <span class="value">{{ getTotalQuantity() }} قطعة</span>
             </div>

             <div class="summary-row">
               <span class="label">المجموع الفرعي:</span>
               <span class="value">{{ total | number:'1.2-2' }} ج.م</span>
             </div>

             <div class="summary-row">
               <span class="label">رسوم الشحن:</span>
               <span class="value free">مجاني</span>
             </div>

             <div class="summary-row">
               <span class="label">الضرائب (14%):</span>
               <span class="value">{{ (total * 0.14) | number:'1.2-2' }} ج.م</span>
             </div>

             <hr class="divider">

             <div class="summary-row total-row">
               <span class="label">الإجمالي النهائي:</span>
               <span class="value">{{ getTotalWithTax() | number:'1.2-2' }} ج.م</span>
             </div>
           </div>

           <div class="summary-actions">
             <button type="button" 
                     class="checkout-btn" 
                     (click)="proceedToCheckout()"
                     [disabled]="cartItems.length === 0">
               <i class="fas fa-credit-card"></i>
               إتمام الطلب الآن
             </button>

            <div class="payment-methods">
              <span class="payment-label">طرق الدفع:</span>
              <div class="payment-icons">
                <i class="fab fa-cc-visa"></i>
                <i class="fab fa-cc-mastercard"></i>
                <i class="fas fa-money-bill-wave"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main> 